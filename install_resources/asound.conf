#############################################################################
# Physical sound card (DigiAMP)
#	- Direct access to the sound card, no extra software processing
#	- Inputs like sample rate, format, and channels must match the hardware
#############################################################################
pcm.oradio_snd_card {
	type hw
	card "DigiAMP"
	device 0
}

#############################################################################
# Mixer allows multiple ALSA applications to play simultaneously
#	- Fully software-based mixing
#	- ipc_key + ipc_perm = shared memory used to combine audio streams
#	- bindings = maps software channels to hardware channels
#############################################################################
pcm.dmixer {
	type dmix
	ipc_key 1024
	ipc_perm 0666
	slave {
		pcm "oradio_snd_card"
		rate 48000
	#	format S32_LE
		format S24_LE   
		channels 2
		period_time 0
		period_size 2048
		buffer_size 8192
	}
	# Needed as sound card has 2 channels
	bindings {
		0 0
		1 1
	}
}

#############################################################################
# Converts sample rate, format, and channel layout to match the slave
#############################################################################
pcm.dmixer_in {
	type plug
	slave.pcm "dmixer"
}

#############################################################################
# Default PCM (for tools that open "default")
#############################################################################
pcm.!default {
	type plug
	slave.pcm "dmixer_in"
}

#############################################################################
# Hardware Control Interface
#############################################################################
ctl.!default {
    type hw
    card "DigiAMP"
}

#############################################################################
# MPD Chain: Separate volume and equalizer for MPD input
# MPD_in -> caps_eq_mpd -> SoftVolMPD -> dmixer_in -> dmix
#############################################################################

#############################################################################
# SoftVolMPD provides a dedicated software volume control for MPD input
#	- Allows MPD playback volume adjustment independently of system master
#	- Works entirely in software
#############################################################################
pcm.SoftVolMPD {
	type softvol
	slave.pcm "dmixer_in"
	control {
		name "VolumeMPD"
		card "DigiAMP"
        }
# Optional: makes volume control more accurate and safe, especially with EQ-boosts which might otherwise clip
#		min_dB -50.0
#		max_dB -6.0
#		resolution 256
}

#############################################################################
# Converts sample rate, format, and channel layout to softvol requirements
#############################################################################
pcm.mpd_equal_out_plug {
    type plug
    slave {
         pcm "SoftVolMPD"
         format S24_LE
         rate 48000
         channels 2
    }
}

#############################################################################
# EqFA4p is a 4-band parametric equalizer from the CAPS LADSPA plugin set
# Note: Automatically converts to FLOAT_LE for LADSPA
# Each band lets you:
#	- choose a center frequency
#	- boost or cut that frequency
#	- control the b (bandwidth)
#
# EqFA4p has 4 identical bands, applied in series:
# Band	Controls	Purpose
# Band 1	<act>  <freq_Hz>  <bw>  <gain_dB> Low-mid shaping
# Band 2	<act>  <freq_Hz>  <bw>  <gain_dB>	Cleanup / body
# Band 3	<act>  <freq_Hz>  <bw>  <gain_dB>	Presence
# Band 4	<act>  <freq_Hz>  <bw>  <gain_dB>Q	High detail
# Gain - master

pcm.caps_eq_mpd {
    type ladspa
    slave.pcm "mpd_equal_out_plug"
    path "/usr/lib/ladspa"

    plugins [
        {
            label EqFA4p
            input {
                controls [
                    1   60     0.9    10.0    
                    1   100    0.35   -5.0    
                    1   1000   1.0    2.0    
                    0   8000   1.0   0.0    
                    -8.0                 
                ]
            }
        }
    ]
}




#############################################################################
# Input PCM exposed to MPD
#############################################################################
pcm.MPD_in {
	type plug
	slave.pcm "caps_eq_mpd"
}

#############################################################################
# MPD Volume Control Interface
#############################################################################
ctl.SoftVolMPD {
   type softvol
   card "DigiAMP"
}

#############################################################################
# Spotify Chain: Separate volume and equalizer for Spotify input
# Spotify_in -> caps_eq_spotify -> SoftVolSpotCon1 -> SoftVolSpotCon2 -> dmixer_in -> dmix
#############################################################################

#############################################################################
# SoftVolSpotify provides a dedicated software volume control for Spotify input
#	- Allows Spotify playback volume adjustment independently of system master
#	- Works entirely in software
#############################################################################
pcm.SoftVolSpotCon2 {
	type softvol
	slave.pcm "dmixer_in"
	control {
		name "VolumeSpotCon2"
		card "DigiAMP"
        }        
# Optional: makes volume control more accurate and safe, especially with EQ-boosts which might otherwise clip
#		min_dB -50.0
#		max_dB -6.0
#		resolution 256
}

#############################################################################
# Spotify Volume Control Interface
#############################################################################
ctl.SoftVolSpotCon2 {
   type softvol
   card "DigiAMP"
}

#############################################################################
# SoftVolSpotify provides a dedicated software volume control for Spotify input
#	- Allows Spotify playback volume adjustment independently of system master
#	- Works entirely in software
#############################################################################
pcm.SoftVolSpotCon1 {
	type softvol
	slave.pcm "SoftVolSpotCon2"
	control {
		name "VolumeSpotCon1"
		card "DigiAMP"
	}
}

#############################################################################
# Spotify Volume Control Interface
#############################################################################
ctl.SoftVolSpotCon1 {
   type softvol
   card "DigiAMP"
}

#############################################################################
# Converts sample rate, format, and channel layout to softvol requirements
#############################################################################
pcm.spotcon_equal_out_plug {
    type plug
    slave {
         pcm "SoftVolSpotCon1"
         format S24_LE
         rate 48000
         channels 2
    }
}

#############################################################################
# EqFA4p is a 4-band parametric equalizer from the CAPS LADSPA plugin set
# Note: Automatically converts to FLOAT_LE for LADSPA
# Each band lets you:
#	- choose a center frequency
#	- boost or cut that frequency
#	- control the Q (bandwidth)
# EqFA4p has 4 identical bands, applied in series:
# Band	Controls	Purpose
# Band 1	freq / gain / Q	Low-mid shaping
# Band 2	freq / gain / Q	Cleanup / body
# Band 3	freq / gain / Q	Presence
# Band 4	freq / gain / Q	High detail
#############################################################################
pcm.caps_eq_spotify {
	type ladspa
    slave.pcm "spotcon_equal_out_plug"
	path "/usr/lib/ladspa"	# location where to find the plugin
    plugins [
        {
            label EqFA4p
            input {
                controls [
                    1   60     0.9    10.0
                    1   100    0.35   -5.0
                    1   1000   1.0    2.0
                    0   8000   1.0   0.0
                    -8.0
                ]
            }
        }
    ]
}

#############################################################################
# Input PCM exposed to Spotify (Librespot)
#############################################################################
pcm.SpotCon_in {
	type plug
	slave.pcm "caps_eq_spotify"
}

#############################################################################
# System Sounds Chain: Separate volume for sytem sounds input
# SysSound_in -> SoftVolSysSound -> dmixer_in -> dmix
#############################################################################

#############################################################################
# SoftVolSysSound provides a dedicated software volume control for system sound input
#	- Allows system sound playback volume adjustment independently of system master
#	- Works entirely in software
#############################################################################
pcm.SoftVolSysSound {
	type softvol
	slave.pcm "dmixer_in"
	control {
		name "VolumeSysSound"
		card "DigiAMP"
# Optional: makes volume control more accurate and safe
#		min_dB -50.0
#		max_dB 0.0
#		resolution 256
	}
}

#############################################################################
# System Sound Volume Control Interface
#############################################################################
ctl.SoftVolSysSound {
   type softvol
   card "DigiAMP"
}
#############################################################################
# Input PCM exposed to SysSound
#############################################################################
pcm.SysSound_in {
	type plug
	slave.pcm "SoftVolSysSound"
}
