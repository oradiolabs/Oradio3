<!DOCTYPE html>
<html lang="nl">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<link rel="stylesheet" href="../static/css/fontawesome.min.css" />
		<link rel="stylesheet" href="../static/css/regular.min.css" />
		<link rel="stylesheet" href="../static/css/oradio3.css" />
		<link rel="stylesheet" href="../static/css/playlists.css" />

		<title>Oradio speellijsten</title>
	</head>
	<body>
		<div class="container">

			<!-- Set presets -->
			<form method="POST">
				<!-- identifier used by server: do not change or remove -->
				<input type="hidden" name="action" value="set_presets" />
				<h1 id="set_presets">Speellijst aan knop koppelen</h1>
				{% for item in presets %}
					<div class="preset-grid">
						<div class="preset-label">
							Voorkeur {{ loop.index }}:
						</div>
						<div>
							<select class="preset-select" name="preset{{ loop.index }}" id="preset{{ loop.index }}">
							{% set index = ["preset", loop.index]|join %}
							{% for folder in folders %}
								{% if presets[index] == folder %}
									<option selected value="{{ folder }}">{{ folder }}</option>
								{% else %}
									<option value="{{ folder }}">{{ folder }}</option>
								{% endif %}
							{% endfor %}
							</select>
						</div>
					</div>
				{% endfor %}
				<button type="submit" name="set_preset">Instellen</button>
			</form>

			<!-- Show songs in a playlist -->
			<form method="POST">
				<!-- identifier used by server: do not change or remove -->
				<input type="hidden" name="action" value="show_songs" />
				<h1 id="show_songs">Liedjes van speellijst tonen</h1>
				<select name="playlist" onchange="this.form.submit()">
					<option selected disabled value="">-- Kies een speellijst --</option>
					{% for folder in folders %}
						{% if playlist == folder %}
							<option selected value="{{ folder }}">{{ folder }}</option>
						{% else %}
							<option value="{{ folder }}">{{ folder }}</option>
						{% endif %}
					{% endfor %}
				</select>
			</form>
			{% if songs %}
			<div class="file-list">
				<ul>
				{% for song in songs %}
					<li>{{ song }}</li>
				{% endfor %}
				</ul>
			</div>
			{% endif %}

			<!-- Create, view, update, delete own playlists -->
			<form method="POST">
				<!-- identifier used by server: do not change or remove -->
				<input type="hidden" name="action" value="custom_playlists" />
				<h1 id="custom_playlists">Eigen speellijst maken</h1>
				<p style="color: #ffef00; text-align: center;">Dit moet nog ge√Ømplementeerd worden... Of niet?</p>
<!--
				<button type="submit" name="custom_create">Eigen speellijst aanmaken</button>
				<button type="submit" name="custom_update">Eigen speellijst bijwerken</button>
				<button type="submit" name="custom_delete">Eigen speellijst verwijderen</button>
-->
			</form>

			<!-- Search songs by artist or title -->
			<form method="POST">
				<!-- identifier used by server: do not change or remove -->
				<input type="hidden" name="action" value="search_songs" />
				<h1 id="search_songs">Lied zoeken</h1>
				{% if search_key %}
					<input type="text" name="pattern" required minlength="3" placeholder="Typ (deel van) naam van artiest of (deel van) titel" value="{{ search_key }}" />
				{% else %}
					<input type="text" name="pattern" required minlength="3" placeholder="Typ (deel van) naam van artiest of (deel van) titel" />
				{% endif %}
				<div id="notification" class="notification">
					<!-- Will be filled by Javascript submitCredentials() -->
				</div>
				<button type="submit" name="search">Zoeken</button>
				{% if search_list %}
				<div class="file-list">
					<ul id="search">
					{% for song in search_list %}
						<li id="{{ song["file"] }}">{{ song["artist"] }} - {{ song["title"] }}</li>
					{% endfor %}
					</ul>
				</div>
				{% endif %}
			</form>

		</div>
	</body>
	<script>
		// Show the element used to trigger a server action
		location.hash = "#" + "{{ anchor }}";

		// Get notification element
		const notification = document.getElementById('notification');

		// Clear old notification
		notification.innerHTML = "";

		// Notify if search key and list is empty
		const key = "{{ search_key }}"
		const list = "{{ search_list }}"
		if ((key != "None") && (key.length > 0) && (list == "[]"))
			notification.innerHTML = '<span style="color: #FFEF00;">Geen liedjes gevonden met \'{{ search_key }}\' in de naam van de artiest of in de titel. Gebruik een andere zoekopdracht.</span>';

		// Catch user clicking a list item
		if (ul = document.getElementById('search'))
		{
			ul.addEventListener('click', function(e)
			{
				if (e.target.tagName === 'LI')
				{
					event.preventDefault();

					// Send song for clicked list item to server fro playback
					submitSong(e.target.id)
				}
			});
		}

		// Function to submit the network and password
		async function submitSong(song)
		{
			// Send song to play to server
			try
			{
				const response = await fetch('/play_song', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify({ "song": song })
				});

				if (! response.ok)
				{
					const errorData = await response.json();
					notification.textContent = "<p style=\"color: #ff0000;\">Error: "+ errorData + "</p>";
				}
			}
			catch (error)
			{
				notification.innerHTML = "<p style=\"color: #ff0000;\">Er is een fout opgetreden bij het indienen van de netwerkreferenties.</p>";
			}
		}
	</script>
</html>
