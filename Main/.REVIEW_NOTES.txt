Legenda===================
T betekent TODO
R betekent reworked
V betekent rework akkoord
==========================

YYYY-MM-DD============================================================================================================================

MESSAGES:
T - Messages 'opschonen', overwegen om json schemas te gebruiken.
	De gekozen message format en definities zijn in de praktijk niet altijd even logisch.
	Voordeel is onderhoudbaarheid, en met json schemas robuust tegen send/receive mismatches

DEBUG / ERRORS:
T - oradio_log.debug/info/warning/error messages nakijken of ze zinvol zijn en op juiste plek gebruikt worden.
	Tijdens ontwikkeling is er vaak exctra debug logging ingeslopen om te controleren of de code werkt als verwacht.
	Echter, de vraag is of als de module af is deze extra debug logging weer opgeruimd is.
T - Default log level van modules die af zijn op 'info' zetten.
	De logfile stroomt nu vol, ook met debug info van modules die niet gedebugged hoeven worden, info genoeg is.
	Voordeel is dat oradio.log nuttiger wordt omdat eht geen overbodige regels bevat
	Voordeel is ook dat Oradio minder cycles nodig heeft om te loggen (maar we hebben geen performance probleem)
	Nadeel is dat áls er iets fout gaat, de logfile mogelijk te weining informatie bevat om de oorzaak van de fout op te sporen
T - Oradio exception introduceren, inclusief handler die gepaste akties neemt.
	Nu worden fouten alleen aamr gelogd, en als we geluk hebben naar RMS gestuurd.
	De fout heeft vaak gevolgen voor het gedrag van de Oradio, waardoor de Oradio onverwachte dingen doet.
	Als de error een Oradio-exception triggert inclusief extra informatie kan de exception handler in extrmis de Oradio opnieuw opstarten.

WEBINTERFACE:
T - Web interface refactoren naar Single Page Architecture (SPA), voor html, javascript en css.
	De web interface bestaat nu uit een collectie losse web pagina's, losse javascript en losse css bestanden.
    Nadeel is dat er veel duplicering van html, javascript en styling is tussen deze pagina's.
	Dit heeft als risico dat er (zinloze/onbegrijpelijke) verschillen insluipen voor de gebruiker.
	Het beste is om de web interface te refactoren naar Single Page Architecture (SPA).
	Bijkomend voordeel is ook dat de server, inclusief de fix voor issue #384, eenvoudiger wordt.

CONTROL:
T - Review na alle module wijzigingen.
	oradio_control is meermaals heen en weer geslingerd om (tijdelijke) wijzigingen in modules te accomoderen.
	Zodra die modules gestabiliseerd zijn wordt het tijd om oradio_control na te kijken, op te schonen

2026-02-07 ============================================================================================================================
Rework op de review van Onno
gpio_service.py
- Ik zie de stand-alone tests van modules liever basic, puur op 'werkt het' gericht
  Uitgebreidere testen, zoals performance en robuustheid graag in aparte module test files zetten
  Zet test code in test file en gebruik override: 'class GPIOServiceTest(GPIOService)'  
  	Henk: aangepast
- Gebruik Google Docstrings style zoals al in veel ander modules.
	Henk: aangepast
- Wees consistent in je gebruik van lege regels.
	Henk: aangepast
- Je hebt heel veel 1-regelige methods, maar je checkt nergens of de argumenten ok zijn, of de actie succes/fail geeft. 
	Graag even toelichten waarom.
	Henk: ik heb de check op argumenten er weer bijgezet, de post-conditie zou dwingend moeten zijn om geen extra test nodig te maken
		  Maar die extra 2 regels code maken het ook niet uit.
- Waarom gebruik je voor docstrings de ene keer ''', de andere keer """ ?
	Henk: erfenis van de "oude code". Heb nu consequent """ gebruikt.
- De ene keer gebruik je dubbel-quotes voor variabelen, de andere keer single quotes. Waarom?
	Henk: ook weer erfenis van de oude code. Heb het nu consequent op dubbel-qoutes gezet waar nodig
- Pylint issues fixen
	Henk: pylint disable issues verwijderd,eentje gebleven nl pylint: disable=protected-access 
- try/export rond RPi import GPIO
	Henk: verwijderd
- Vele ### zijn verwarrend
	Henk: verwijderd
- Geen exceptions om fouten te propageren,is onderdeel van issue #408
	Henk: exceptions verwijderd
- docstrings verduidelijken in geval parameter check niet nodig is
	Henk: in post-condition opgenomen, maar toch ook maar de check toegevoegd
- Zet een locks daar waar potentiele conflicten mogelijk zijn
- led_state in get_led_state() in return statement zetten
	Henk: aangepast
- state in get_button_state() in return statement zetten
	Henk: aangepast
- if callable gebruiken als je op een geldige callback functie wilt testen
	Henk: aangepast
- ipv expliciete True/False returns kan je ook 'return callable(callback)
	Henk: geen returns meer, is voor later. Alleen error-log
- def _edge_callback return code klopt niet mbt typehint in docstring
	Henk: aangepast
- toelichting in _edge_callback hoe button_data{} gebruikt wordt als TEST_ENABLED is
	Henk: aangepast

touch_buttons.py
- Ik zie de stand-alone tests van modules liever basic, puur op 'werkt het' gericht
  Uitgebreidere testen, zoals performance en robuustheid graag in aparte module test files zetten
  Zet test code in test file en gebruik override: 'class GPIOServiceTest(GPI_Service)
	Henk: aparte folder module_test gemaakt voor uitgebreidere module testen:
  		* touch_buttons_test.py : test programma die touch buttons simulaties gebruikt voor performance metingen 
  		* touch_buttons_test_classes.py: de extensies op de GPIOService in TestGPIOService() en TimingData()
- Stel voor de Google Docstrings style te gebruiken, zoals al in veel ander modules.
	Henk: aangepast
- TimingData.__init__(): gebruik self.reset() ipv allcode van reset hier dupliceren
	Henk: aangepast
- TimingData.reset(): self.valid_callbacks = {} kan weg -> wordt 2 regels later ook weer gewist
	Henk: toch wel nodig omdat de keys mbt button_name gedefineerd moeten zijn, voordat ze later gebruikt kunnen worden
- Wees consistent in je gebruik van lege regels.
	Henk: aangepast
- Waarom gebruik je voor docstrings de ene keer ''', de andere keer """ ?
	Henk: aangepast
- Je zet op veel plekken pylint uit, wel met motivatie, maar kijk nog eens kritisch of al die disables wel echt nodig zijn.
  En zet waar kan de disable op de betreffende regel
  En als je toch een pylint op een code block moet zetten voeg dan zodra het kan de pylint enable regel toe
  Oftewel: pylint disables zo spaarzaam en gericht mogelijk gebruiken
  Henk: aangepast
- play_soung import hoort bij block 'oradio_modules': verplaatsen
	Henk: aangepast
- pylint too-few-public-methods check wordt al gedisabled in .pylintrc, dus hoeft hier niet ook nog een keer
	Henk: aangepast
- f"{...}" constructs vermijden bij oradio_log(), want wordt altijd geevalueerd, ook als log level hoger is. 
  De aanbevolen construct is ("...%s...", value)
  	Henk: aangepast
- _send_message(): Waarom state variabele? JE kan meteen message["state"] assignen
	Henk: aangepast
- _send_message(): Waarom gebruik je hier print? oradio_log.error() lijkt mij de juiste...
	Henk: aangepast
- _button_event_callback():Waarom zo'n complexe constructie om een debug message te construeren?
	Henk: aangepast
- _button_event_callback(): Typo (to -> too) en 'neglected' is niet juist, moet 'ignored' zijn.
	Henk: aangepast
- _button_event_callback(): Waarom gebruik je hier print? oradio_log.debug() lijkt mij de juiste...
	Henk: wordt gebruikt onder conditie TEST_ENABLED

led_control.py
- turn_off_led en turn_on_led geven een true/false terug, maar daar wordt nergens op gecontroleerd.
     Dus óf overal controleren, óf geen bool retourneren. Bij oplossen van issue #408 komt dat dan later wel goed...
	Henk: aangepast
- oneshot en blinking gebruiken een tijdseenheid als argument. oneshot heeft een default, blinking niet, waarom?
  Stel voor 2 lokale variabelen te definieren, als default voor oneshot en blinking te gebruiken.
  En dan in oradio_control overal die ,2 als agument voor blinking weg te halen.
	Henk: aangepast
- f"{...}" constructs vermijden, want wordt altijd geevalueerd, ook als log level hoger is. 
  De aanbevolen construct is ("...%s...", value)
	Henk: aangepast  
- We gebruiken geen exceptions om fouten te propageren. (onderdeel van issue #408)
	Henk: aangepast
- turn_on_led_with_delay() : Waarom nu niet meteen oradio_control aanpassen? 
  Dan kan deze method weg, kan je het ook niet vergeten...
	Henk: aangepast 
- turn_off_led(): Er wordt nergens op de return gecontroleerd -> None teruggeven
	Henk: aangepast
- Duidelijker is een aparte stop_blink() method te maken, die in turn_led_off en turn_led_on te gebruiken
	Henk: aangepast
- turn_on_led(): return type hint ontbreekt. Er wordt nergens op de return gecontroleerd -> None teruggeven
	Henk: aangepast
- oneshot_on_led():Er wordt alleen in de stand-alone test case 3 op de return gecontroleerd, maar niets mee gedaan als false:
  Stel daarom voor om None terug te geven, in method _single_led_test test case 3 niet op testen, 
  in turn_on_led_with_delay niet te retourneren
	Henk: aangepast  
- Method naam 'oneshot_led_off' is andere stijl dan overige methods. Hernoem naar 'oneshot_off_led'
	Henk: aangepast
- control_blinking_led():Zou ook hier geen bool retourneren, net als de andere methods in deze class
  Let wel op dat je dan de check in de method _single_led_test test case 4 verwijdert
  control_blinking_led()._blink(): verplaats docstring cycle time uitleg hierboven naar docstring van deze method
	Henk: aangepast  

oradio_control.py:
Aanpassingen:
1) Message afhandeling toegevoegd voor de touch_buttons berichten
2) touch_buttons callbacks verwijderd
3) module test toegevoegd

Algemeen:
Voor elke module test de mogelijkheid toegevoegd om een remote debugger te gebruiken, deze staat default uit.

2026-01-11============================================================================================================================

GPIO:
gpio_service.py
1) gpio output en setup verwijderd uit led_control en in gpio_service gezet:
	a) set_led_on(), set_led_off()
	b) __init__(): setup for led-pins
	c) get_led_state()
2) gpio input en setup verwijderd uit touch_buttons en in gpio_service gezet:
	a) get_button_state(), _read_pin_state()
	b) b) __init__(): setup for button-pins
	c) set_button_edge_event_callback(), _edge_callback
3) test methodes om callbacks te simuleren:
	a) simulate_button_play_events_burst(),
	   simulate_all_buttons_events_burst(), 
	   simulate_button_press_and_release()
	b) GPIO_MODULE_TEST geintroduceerd zodat de edge_callback gebruikt kan worden
		voor de callback simulatie. GPIO_MODULE_TEST wordt door een module test geactiveerd.
		In de callback wordt een extra timestamp meegestuurd, voor de tijdsmeting
4) Module testen uitgewerkt
5) nieuwe global defines aangemaakt voor buttons en leds, voor oradio_controls
6) Remote debugging toegevoegd voor module testen

led_control:
1) functies aangepast voor gpio_service gebruik: 
	a) turn_on_led(), turn_off_led(), turn_off_all_leds(), turn_on_all_leds()
	b) oneshot_on_led(), maakt gebruik van timer ipv sleep() functie
	c) control_blinking_led(): docstring aangepast
	d) turn_on_led_with_delay() tijdelijk als wrapped voor oneshot_on_led()
2) Module testen uitgewerkt
3) Remote debugging toegevoegd voor module testen

touch_buttons.py:
1) Geen callbacks meer naar oradio_controls. 
	De berichten voor de queue worden aangemaakt volgens de OradioMessage klasse structuur
2) In de _button_event_callback() die door gpio_service aangeroepen wordt, zitten tijds metingen,
	zodat de propagatie tijd gemeten kan worden vanaf moment dat de gpio-callback getriggered is.
	Hierbij wordt gebruik gemaakt van de timestamp die meegestuurd wordt in de callback
3) Een data klasse TimingData geintroduceerd om de statistiek van de tijdsmetingen bij te houden
4) Software debouncing overgenomen, maar wel test functies eromheen gezet.
5) Click-sound speelt direct af via play_sound() functie, geen instantie meer nodig. 
6) Module testen uitgewerkt
7) Remote debugging toegevoegd voor module testen

oradio_control.py:
1) De extra berichten en calls mbt de buttons toegevoegd voor de message_handler.
2) Geen callbacks meer tijdens instantatie van TouchButtons()
3) Button en Led self-tests eruit gehaald

oradio_utils.py
1) De klasse OradioMessage() geintroduceerd waarmee de message structuur voor oradio berichten wordt gedefinieerd
2) Een functie validate_oradio_message() die een queue bericht kan valideren op basis van de OradioMessage klasse.
3) Input functies tbv testen input_prompt_int() en input_prompt_float(), als utility voor test module

remote_debugger.py
Deze module verzorgt een verbinding van de RPI met een IDE op een PC, zodat remote debugging mogelijk is
Default is de pydevd (python debugger) niet geinstalleerd, de ontwikkelaar moet dit zelf doen
De setup_remote_debugging() functie kan een verbinding tot stand te brengen.
Er zijn een paar pre-condities waaraan voldaan moet worden om wel of geen remote-debug te kunnen:
1) Default is pydevd niet geinstalleerd, de ontwikkelaar moet dit doen mbv: pip install pydevd
2) Er is een constante REMOTE_DEBUGGER:
	a) die default op DEBUGGER_DISABLED staat:in dit geval is er geen debugging mogelijk
	b) de ontwikkelaar kan deze op DEBUGGER_ENABLED zetten: als pydevd bestaat dan kan debugger gestart worden
		mebv setup_remote_debugging() functie
3) De remote debugger heeft informatie (argumenten) nodig om een verbinding tot stand te brengen bij aanroep van module.
	bijvoorbeeld: python led_control.py -rd yes -ip 192.168.xxx.xxx -p 5678
	waarbij -ip het ip adres vd host is en -p het gebruikte portnr
Dus bij een klanten-release zit pydevd er niet in. Als de ontwikkelaar de remote-debugger wil gebruiken dan moet
deze de pydevd installeren op de RPi.
Voor mij is het handig dat de benodigde software voor remote debugging in ons oradio pakket zit. 
Ook even opletten, de ontwikkelaar moet de remote_debugger-py NIET terugzetten in github, als de DEBUGGER_ENABLED was.
Mogelijk zouden we deze module moeten afschermen, dat alleen de "CODEOWNER" deze module mag aanpassen. 

nog doen:
- documentatie op orde brengen
- Eerdere opmerkingen van 10 oktober 2025 over GPIO hieronder in bovenstaande mergen

GPIO, led_control.py rework: een nieuwe gpio_service en led_control.py is aangemaakt, waarin onderstaande zaken verwerkt zijn
Henk review: led_control.py
R - GPIO zaken ontkoppelen uit led_control.py. De GPIO wordt zowel in led_control als in touch_buttons geinitialiseerd. 
    Zou op 1 plek moeten. Daarom GPIO zaken in een aparte module gpio_service.py afhandelen. 
    Daarbij een klasse aanbieden met config en set/get methodes. 
    Geeft betere abstractie door toevoeging van een hardware abstractie laag
R - methodes turn_off_led(), turn_on_led(), turn_on_led_with_delay() moeten een True/False teruggeven
R - delayed_off() thread gebruikt een sleep als delay.Beter is om een Timer thread te gebruiken
R - control_blinking_led(self, led_name, cycle_time=None), graag de cycle_time parameter specificeren.
R - De selftest is niet doelmatig. Beter is om  te testen of de leds ook werkelijk aan of uit staan door de GPIO status op te vragen van de geactiveerde led. 
    Hiermee test je of de leds werkelijk aan of uit staan.==> Als een instantie van GPIOService wordt aangemaakt, wordt getest of pinnen beschikbaar zijn.

2026-01-12============================================================================================================================

USB:
Documents/USB/USB module description.docx:
V - Updated to include handling Wifi_invoer.json
V - De __getattr__() is een private method, zou niet in de API beschrijving van de Module: USBObserver moeten staan
usb_service.py:
V - Parsing van Wifi_invoer.json toegevoegd
V - doc strings, type hints and inline comments opgeschoond
V - Waarom is de __getattr__() nodig? Graag toelichting voor gebruik hiervan
=> Review/Rework conclusie: Rework akkoord. Hiermee is review afgesloten

Wifi:
Documents/WIFI/WIFI module description.docx:
V - Updated to include handling Wifi_invoer.json
wifi_service.py:
V - Parsing van Wifi_invoer.json verwijderd
V - doc strings, type hints and inline comments opgeschoond
V - USB functionaliteit is verwijderd, maar er staan nog USB zaken in de code:
V   - self.usb_q wordt niet gebruikt
V   - De locals DEBOUCE_TIME, WIFI_MONITOR en USB_WIFI_FILE worden niet meer gebruikt
V   - docstring: 'Listens to USB xxxxx' is niet aan de orde
=> Review/Rework conclusie: Rework akkoord. Hiermee is review afgesloten

2026-01-06============================================================================================================================

AUDIO:
asound.conf:
V - Use 24 bit resolution
V - Use 48 kHz sampling rate
V - Replace equal by EqFA4p
volume_control.py:
V - alsaaudio import, en daarmeer class AlsaVolume is verdwenen
V - __init_ configureert de default MPD, Sounds en Spotify volumes
V - set_volume() gebruikt nu run_shell_script() om volume in te stellen
play_system_sound.py:
V - Default MPD, Sounds en Spotify volumes verhuisd naar volume_control.py
V - "duck en restore" volume regeling verwijderd
V - Class PlaySystemSound is verwijderd
V - Hernoemd naar system_sounds.py
system_sounds.py:
V - play_sound() functie speelt sound asynchroon af
V - Use sound constants
=> Review/Rework conclusie: Rework akkoord. Hiermee is review afgesloten

2025-12-07============================================================================================================================

oradio_logging.py:
V - log methods safe gemaakt met wrappers dei exceptions afvangen
V - versturen van WARNING, ERROR en CRITICAL logs naar remote server toegevoegd
V - onafhankelijk gemaakt van andere oradio modules
V - Technische documnetatie bijgewerkt
remote_monitoring.py:
V - Versturen van WARNING, ERROR en CRITICAL logs naar remote server verwijderd
V - Beheren van HEARTBEAT en SYS_LOG messages afhankelijk gemaakt vna wifi state
V - Technische documnetatie bijgewerkt

2025-11-10============================================================================================================================

GPIO:
Henk review: led_control.py
1 - GPIO zaken ontkoppelen uit led_control.py. De GPIO wordt zowel in led_control als in touch_buttons geinitialiseerd. 
    Zou op 1 plek moeten. Daarom GPIO zaken in een aparte module gpio_service.py afhandelen. 
    Daarbij een klasse aanbieden met config en set/get methodes. 
    Geeft betere abstractie door toevoeging van een hardware abstractie laag
2 - methodes turn_off_led(), turn_on_led(), turn_on_led_with_delay() moeten een True/False teruggeven
3 - delayed_off() thread gebruikt een sleep als delay.Beter is om een Timer thread te gebruiken
4 - control_blinking_led(self, led_name, cycle_time=None), graag de cycle_time parameter specificeren.
5 - De selftest is niet doelmatig. Beter is om  te testen of de leds ook werkelijk aan of uit staan door de GPIO status op te vragen van de geactiveerde led. 
    Hiermee test je of de leds werkelijk aan of uit staan.

2025-11-18============================================================================================================================

I2C:
V Review Documents/I2C/I2C_modules_description.docx
volume_control review:
V - AlsaVolume.set() VolumeControl._set_volume() geven nu True/False terug. Wordt in manager bewust genegeerd.
V - De de exception komt als mixer_name niet bestaat, of initialisatie mislukt -> Extra comments toegevoegd aan AlsaVolume::__init__ in volumne_control.py
V - raw_value range is niet beperkt, want wordt in method geclamped
V - Ontbrekende foutmelding -> toegevoegd
V - Zie punt 1
V - Zie punt 1
V - errors propageren nu niet, worden alleen gelogd. Zie issue #408
=> Review/Rework conclusie: Rework akkoord. Hiermee is review afgesloten.
backligting.py review:
V - Het is een vrij theoretisch geval: EEPROMS hebben een beperkt aantal write cycles.
      Nu wordt de EEPROM elke keer als Oradio en backlighting start geschreven.
	  Het is strikt genomen voldoende als dit eenmalig bij configuratie van Oradio gedaan wordt, dus in oradio_install.sh.
	  Maar omdat EEPROM schrijfbeperking bij 40-50000 cycles ligt hoeven we ons daar niet echt druk over te maken.
	  Kortom: we laten het in Backlighting::__init__ zitten. Eens?
V - de stop() method docstring is niet correct: Stop the Backlight manager ipv volume control. Gecorrigeerd
=> Review/Rework conclusie: Rework akkoord. Hiermee is review afgesloten.
i2c_service.py review:
V - Reworked: een retry mechanisme voor write_byte() en write_block() toegevoegd
=> Review/Rework conclusie: Rework akkoord. Hiermee is review afgesloten

2025-11-10============================================================================================================================

MPD:
mpd_service.py:
V - Verhuis MPDService naar eigen file mpd_service.py, laat mpd_control.py en mpd_monitor.py die importeren
mpd_control.py:
V - mpd_client singleton moet eruit
V - Gebruik 'Singleton metaclass' in mpd_control.py
V - functies die waarde retourneren maar deze genegeerd wordt moeten _ = <functie>  gebruiken om te laten zien dat negeren bewust is
V - Probleem in _remove_song_when_finished(), met een if conditie waarbij een int() met een string vergeleken wordt: de "deleteid" wordt niet uitgevoerd
V - Hetzelfde probleem in play_song(), ook een int()/String compare. Graag ook de single-line-code minder complex maken door meerdere code regels er aan te wijden. De code is dan beter leesbaar en te begrijpen. Ik heb voorbeeld toegevoegd.
V - Probleem met twee self._execute() die bij elkaar gevoegd worden. Gaat fout als er None terugkomt==> TypeError
V - Groene tekst als een module test optie een succes oplevert.
mpd:monitor.py:
V - Listener moet aparte singleton class worden
V - functies die waarde retourneren maar deze genegeerd wordt moeten _ = <functie>  gebruiken om te laten zien dat negeren bewust is
V - Gebruik 'Singleton metaclass' in mpd_monitor.py
V - Groene tekst als een module test optie een succes oplevert.
=> Review/Rework conclusie: Rework akkoord. Hiermee is review afgesloten.
